DROP DATABASE IF EXISTS prelim;
CREATE DATABASE prelim;
USE prelim;

CREATE TABLE customer(
	CUSTOMER_ID int(20) NOT NULL PRIMARY KEY AUTO_INCREMENT,
    LAST_NAME varchar(50) NOT NULL,
    FIRST_NAME varchar(50) NOT NULL,
    PHONE_NUMBER varchar(50) NOT NULL,
    ADDRESS varchar(50) NOT NULL,
    CITY varchar(50) NOT NULL,
    STATE varchar(50) NOT NULL,
    COUNTRY varchar(50) NOT NULL,
    POSTAL_CODE int(20) NOT NULL
);

CREATE TABLE car(
	CAR_ID int(20) NOT NULL PRIMARY KEY AUTO_INCREMENT,
    SERIAL_NUMBER int(20) NOT NULL,
    MAKE varchar(50) NOT NULL,
    MODEL varchar(50) NOT NULL,
    COLOUR varchar(50) NOT NULL,
    CAR_YEAR int(20) NOT NULL,
    CAR_FORSALE enum ('Y','N')
);

CREATE TABLE salesperson(
 	SALESPERSON_ID int(20) NOT NULL PRIMARY KEY AUTO_INCREMENT,
    LAST_NAME varchar(50) NOT NULL,
    FIRST_NAME varchar(50) NOT NULL
);

CREATE TABLE mechanic(
	MECHANIC_ID int(20) NOT NULL PRIMARY KEY AUTO_INCREMENT,
    LAST_NAME varchar(50) NOT NULL,
    FIRST_NAME varchar(50) NOT NULL
);

CREATE TABLE service(
	SERVICE_ID int(20) NOT NULL PRIMARY KEY AUTO_INCREMENT,
    SERVICE_NAME varchar(50) NOT NULL,
    HOURLY_RATE int(20) NOT NULL
);

CREATE TABLE parts(
	PARTS_ID int(20) NOT NULL PRIMARY KEY AUTO_INCREMENT,
    PART_NUMBER INT(20) NOT NULL,
    DESCRIPTION varchar(50) NOT NULL,
    PURCHASE_PRICE int(20) NOT NULL,
    RETAIL_PRICE int(20) NOT NULL
);

CREATE TABLE service_ticket(
    SERVICE_TICKET_ID int(20) NOT NULL PRIMARY KEY AUTO_INCREMENT,
    SERVICE_TICKET_NUMBER INT(20) NOT NULL,
    CAR_ID int(20) NOT NULL,
    CUSTOMER_ID int(20) NOT NULL,
    DATE_RECEIVED varchar(50) NOT NULL,
    COMMENTS varchar(50) NOT NULL,
    DATE_RETURNED_TO_CUSTOMER varchar(50) NOT NULL,
    CONSTRAINT servicecar FOREIGN KEY (CAR_ID) REFERENCES car(CAR_ID),
    CONSTRAINT servicecust FOREIGN KEY (CUSTOMER_ID) REFERENCES customer(CUSTOMER_ID)
);

CREATE TABLE sales_invoice(
	INVOICE_ID int(20) NOT NULL PRIMARY KEY AUTO_INCREMENT,
    INVOICE_NUMBER int(20) NOT NULL,
    INVOICE_DATE varchar(50) NOT NULL,
    CAR_ID int(20) NOT NULL,
    CUSTOMER_ID int(20) NOT NULL,
    SALESPERSON_ID int(20) NOT NULL,
    CONSTRAINT salecar FOREIGN KEY (CAR_ID) REFERENCES car (CAR_ID),
    CONSTRAINT salecust FOREIGN KEY (CUSTOMER_ID) REFERENCES customer(CUSTOMER_ID),
    CONSTRAINT saleperson FOREIGN KEY (SALESPERSON_ID) REFERENCES salesperson(SALESPERSON_ID)
);

CREATE TABLE service_mechanic(
	SERVICEMECHANIC_ID int(20) NOT NULL PRIMARY KEY AUTO_INCREMENT,
    SERVICE_TICKET_ID int(20) NOT NULL,
    SERVICE_ID int(20) NOT NULL,
    MECHANIC_ID int(20) NOT NULL,
    HOURS int(20) NOT NULL,
    SERVICE_COMMENT varchar(50) NOT NULL,
    RATE varchar(50) NOT NULL,
    CONSTRAINT serviceticket FOREIGN KEY (SERVICE_TICKET_ID) REFERENCES service_ticket(SERVICE_TICKET_ID),
    CONSTRAINT serviceservice FOREIGN KEY (SERVICE_ID) REFERENCES service(SERVICE_ID),
    CONSTRAINT servicemechanic FOREIGN KEY (MECHANIC_ID) REFERENCES mechanic(MECHANIC_ID)
);

CREATE TABLE parts_used(
 	PARTS_USED_ID int(20) NOT NULL PRIMARY KEY AUTO_INCREMENT,
    PARTS_ID int(20) NOT NULL,
    SERVICE_TICKET_ID int(20) NOT NULL,
    NUMBER_USED int(20) NOT NULL,
    PRICE int(20) NOT NULL,
    CONSTRAINT partsparts FOREIGN KEY (PARTS_ID) REFERENCES parts(PARTS_ID),
    CONSTRAINT partsserviceticket FOREIGN KEY (SERVICE_TICKET_ID) REFERENCES service_ticket(SERVICE_TICKET_ID)
)

